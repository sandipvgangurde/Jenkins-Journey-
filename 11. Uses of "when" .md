# ðŸ§© **ðŸ“˜All `when` Conditions in Jenkins (Declarative Pipeline + Comments + Use Cases)**

---

# ðŸ“Š **Legend (What Each Symbol Means)**

| Symbol | Meaning                            |
| ------ | ---------------------------------- |
| ðŸ’¡     | What the condition does            |
| ðŸ­     | CI/CD real-world use case          |
| ðŸ“¦     | Full pipeline example (copy/paste) |
| ðŸ’¬     | Comments inside code               |

---

---

# âœ… **1. Run Stage Only on `main` Branch**

ðŸ’¡ *Ensures only the main branch triggers this stage.*

ðŸ­ *Use case:* Only deploy production code from `main`.

---

ðŸ“¦ **Full Pipeline**

```groovy
pipeline {
    agent any

    stages {
        stage('Deploy') {
            when {
                branch 'main'        // ðŸ’¬ Only run when we're on the main branch
            }
            steps {
                echo "Deploying from MAIN branch..."  // ðŸ’¬ Safe deployment point
            }
        }
    }
}
```

---

# ðŸš« **2. Skip Stage on Branch = `dev`**

ðŸ’¡ *Prevent certain steps from running on development branches.*

ðŸ­ *Use case:* Donâ€™t waste resources running heavy tests in dev.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    stages {
        stage('Integration Tests') {
            when {
                not {
                    branch 'dev'     // ðŸ’¬ Skip on dev; run on all other branches
                }
            }
            steps {
                echo "Running integration tests on non-dev branch..."
            }
        }
    }
}
```

---

# ðŸŒ **3. Run Only If ENV Variable = prod**

ðŸ’¡ *Stage runs depending on environment variables.*

ðŸ­ *Use case:* Auto-run production-only stages.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    environment {
        DEPLOY_ENV = "prod"          // ðŸ’¬ Simulated environment variable
    }

    stages {
        stage('Production Stage') {
            when {
                environment name: 'DEPLOY_ENV', value: 'prod'  
                // ðŸ’¬ Stage runs only if DEPLOY_ENV equals "prod"
            }
            steps {
                echo "This stage runs because DEPLOY_ENV = prod"
            }
        }
    }
}
```

---

# ðŸ”˜ **4. Only Run If Parameter = true**

ðŸ’¡ *Run based on user input.*

ðŸ­ *Use case:* Optional security scan checkbox.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    parameters {
        booleanParam(name: 'RUN_SECURITY_SCAN', defaultValue: false)
    }

    stages {
        stage('Security Scan') {
            when {
                expression { params.RUN_SECURITY_SCAN }  // ðŸ’¬ If checkbox was ticked
            }
            steps {
                echo "Running security scan..."
            }
        }
    }
}
```

---

# ðŸ“ **5. Run Only If Java Files Changed**

ðŸ’¡ *Trigger stage if specific files change.*

ðŸ­ *Use case:* Run backend tests only if backend code changed.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    stages {
        stage('Java Tests') {
            when {
                changeset "**/*.java"    // ðŸ’¬ True if any Java file was modified
            }
            steps {
                echo "Java files changed â€” running Java tests..."
            }
        }
    }
}
```

---

# ðŸ§® **6. Using `equals`**

ðŸ’¡ *Generic comparison between two values.*

ðŸ­ *Use case:* Enable/disable feature flags.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    environment {
        DEPLOY = "true"   // ðŸ’¬ ENV variable we will compare
    }

    stages {
        stage('Check Flag') {
            when {
                equals expected: "true", actual: env.DEPLOY  
                // ðŸ’¬ Only run if DEPLOY == "true"
            }
            steps {
                echo "DEPLOY flag is TRUE â€” executing stage."
            }
        }
    }
}
```

---

# ðŸ”¥ **7a. `expression` â€” Feature Branch Logic**

ðŸ’¡ *Most flexible condition â†’ any Groovy expression.*

ðŸ­ *Use case:* Only run special steps for feature branches.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    stages {
        stage('Feature Build') {
            when {
                expression { 
                    env.BRANCH_NAME.startsWith("feature/")  
                    // ðŸ’¬ True if branch name starts with feature/
                }
            }
            steps {
                echo "This is a feature branch â€” running feature build..."
            }
        }
    }
}
```

---

# ðŸ”¥ **7b. Expression â€” Validate Version String**

ðŸ’¡ *Use regex for validation.*

ðŸ­ *Use case:* Prevent invalid version releases.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    parameters {
        string(name: 'VERSION', defaultValue: '1.0.0')
    }

    stages {
        stage('Validate Version') {
            when {
                expression { 
                    params.VERSION ==~ /\d+\.\d+\.\d+/  
                    // ðŸ’¬ Regex match: X.Y.Z format only
                }
            }
            steps {
                echo "Valid Version: ${params.VERSION}"
            }
        }
    }
}
```

---

# ðŸ§© **8. Combine Using `allOf`**

ðŸ’¡ *Both conditions must be true.*

ðŸ­ *Use case:* Deploy only if:
âœ” branch = main
âœ” deploy flag = true

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    parameters {
        booleanParam(name: 'DEPLOY', defaultValue: false)
    }

    stages {
        stage('Deploy') {
            when {
                allOf {
                    branch 'main'        // ðŸ’¬ Condition 1
                    expression { params.DEPLOY } // ðŸ’¬ Condition 2
                }
            }
            steps {
                echo "Deploying because: (branch=main AND DEPLOY=true)"
            }
        }
    }
}
```

---

# ðŸ”˜ **9. OR Logic with `anyOf`**

ðŸ’¡ *Run when ANY condition is true.*

ðŸ­ *Use case:* Special build for hotfix OR release.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    stages {
        stage('Special Build') {
            when {
                anyOf {
                    branch 'hotfix'   // ðŸ’¬ OK if hotfix
                    branch 'release'  // ðŸ’¬ OK if release
                }
            }
            steps {
                echo "Running special build (hotfix OR release)..."
            }
        }
    }
}
```

---

# ðŸš« **10. Negation With `not`**

ðŸ’¡ *Run when the opposite is true.*

ðŸ­ *Use case:* Only run cleanup on ALL branches except dev.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    stages {
        stage('Non-Dev Stage') {
            when {
                not {
                    branch 'dev'     // ðŸ’¬ True when branch != dev
                }
            }
            steps {
                echo "This stage runs because branch is NOT dev."
            }
        }
    }
}
```

---

# âš¡ **11. Use `beforeAgent` to Skip Stage Early**

ðŸ’¡ *Prevents agent startup â†’ saves cost/time.*

ðŸ­ *Use case:* Skip stage if file missing (NO agent needed).

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    stages {
        stage('Check File') {
            when {
                beforeAgent true           // ðŸ’¬ Evaluate before starting an agent
                expression { fileExists('LICENSE') } // ðŸ’¬ True if file exists
            }
            steps {
                echo "LICENSE file found â€” executing stage."
            }
        }
    }
}
```

---

# ðŸ§  **12. Time-Based Condition**

ðŸ’¡ *Run only during business hours.*

ðŸ­ *Use case:* Avoid running expensive tasks at midnight.

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    stages {
        stage('Business Hours Only') {
            when {
                expression {
                    def hour = new Date().format("H") as int
                    hour >= 9 && hour <= 17      // ðŸ’¬ 9 AM to 5 PM
                }
            }
            steps {
                echo "Inside business hours â€” running stage."
            }
        }
    }
}
```

---

# ðŸ—ï¸ **13. Full Multi-Condition Template**

ðŸ’¡ *Combines multiple real-world checks.*

ðŸ­ *Use case:*
âœ” main branch
âœ” feature flag = true
âœ” user confirmed
âœ” skip if agent not needed

---

ðŸ“¦ **Pipeline**

```groovy
pipeline {
    agent any

    parameters {
        booleanParam(name: 'RUN_STEP', defaultValue: false)
    }

    environment {
        DEPLOY_FLAG = "true"
    }

    stages {
        stage('Example Stage') {
            when {
                beforeAgent true                 // ðŸ’¬ Fast-skip if false
                allOf {
                    branch 'main'                // ðŸ’¬ Must be main
                    environment name: 'DEPLOY_FLAG', value: 'true' // ðŸ’¬ Feature flag
                    expression { params.RUN_STEP }   // ðŸ’¬ User confirmation
                }
            }
            steps {
                echo "Stage executed because ALL conditions passed ðŸ‘"
            }
        }
    }
}
```

---

# ðŸ“Š **Comparison Table of All 13 `when` Conditions**

| Condition             | Type             | Power | Use Case                    |
| --------------------- | ---------------- | ----- | --------------------------- |
| branch                | branch name      | â­â­â­   | deploy on main              |
| not                   | logical negation | â­â­â­   | skip dev branch             |
| environment           | env var          | â­â­    | prod only                   |
| changeset             | file detection   | â­â­â­   | run tests if folder changed |
| equals                | generic compare  | â­â­    | feature flags               |
| expression            | custom logic     | â­â­â­â­â­ | regex, logic, conditions    |
| allOf                 | AND logic        | â­â­â­â­  | multi-safe deploys          |
| anyOf                 | OR logic         | â­â­â­   | hotfix/release              |
| beforeAgent           | optimization     | â­â­â­   | skip agent cost             |
| time-based expression | custom           | â­â­â­â­  | avoid night runs            |

---

# ðŸ“‰ **Mini ASCII Flow Chart (How `when` Works)**

```
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Start      â”‚
            â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Evaluate `when`    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚True
           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Run Stage     â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚False
           â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Skip Stage    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

